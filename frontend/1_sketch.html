<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>가꿈 - 가구 스캐치</title>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        
        <style>
            * {
                font-family: 'Space Grotesk', sans-serif;
            }
            :root {
                --gradient-primary: linear-gradient(135deg, #6366F1, #A855F7);
            }
            .gradient-text {
                background: var(--gradient-primary);
                -webkit-background-clip: text;
                background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.8);
                backdrop-filter: blur(12px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            .canvas-bg {
                background: linear-gradient(135deg, #EEF2FF 0%, #F5F3FF 100%);
                position: relative;
                overflow: hidden;
            }
            .canvas-bg::before {
                content: '';
                position: absolute;
                width: 100%;
                height: 100%;
                background-image: 
                    radial-gradient(circle at 1px 1px, #6366F1 1px, transparent 0),
                    radial-gradient(circle at 1px 1px, #A855F7 1px, transparent 0);
                background-size: 30px 30px, 50px 50px;
                background-position: 0 0, 15px 15px;
                opacity: 0.1;
            }
            .tool-button {
                transition: all 0.3s ease;
            }
            .tool-button:hover {
                background: var(--gradient-primary);
                color: white;
                transform: translateY(-2px);
            }
            /* 활성화된 도구 버튼 스타일 */
            .active-tool {
                background: var(--gradient-primary) !important;
                color: white !important;
            }
            .upload-area {
                border: 2px dashed #6366F1;
                transition: all 0.3s ease;
            }
            .upload-area:hover {
                border-color: #A855F7;
                background: rgba(99, 102, 241, 0.05);
            }
            .gradient-border {
                position: relative;
                background: linear-gradient(white, white) padding-box,
                            var(--gradient-primary) border-box;
                border: 2px solid transparent;
            }
            .card-hover {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .card-hover:hover {
                transform: translateY(-8px);
                box-shadow: 0 20px 40px rgba(99, 102, 241, 0.15);
            }
            /* Carousel 관련 스타일 */
            #referencesCarousel {
                position: relative;
                overflow: hidden;
            }
            #carouselInner {
                display: flex;
                transition: transform 0.5s ease;
            }
            .reference-item {
                flex-shrink: 0;
                width: 100%;
            }
        </style>
        
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const canvas = document.getElementById("sketchCanvas");
                const ctx = canvas.getContext("2d");
        
                // 실제 픽셀 해상도를 256x256으로 고정
                canvas.width = 256;
                canvas.height = 256;
        
                // 캔버스 초기화 함수 - 검은색 배경으로 변경
                function clearCanvas() {
                    ctx.fillStyle = "#000000";
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                }
        
                // 초기 캔버스 설정
                clearCanvas();
                ctx.lineCap = "round";
                ctx.lineWidth = 2;
        
                // 도구 버튼 (ID를 부여하여 기존 기능은 그대로 유지)
                const pencilBtn = document.getElementById("pencilBtn");
                const lineBtn = document.getElementById("lineBtn");
                const circleBtn = document.getElementById("circleBtn");
                const squareBtn = document.getElementById("squareBtn");
                const eraserBtn = document.getElementById("eraserBtn");
                const clearBtn = document.getElementById("clearBtn");
        
                // 크기 조절 슬라이더
                const sizeSlider = document.querySelector("input[type='range']");
                
                // 현재 도구 (기능은 그대로 유지, 기본은 pencil)
                let currentTool = "pencil";
                let drawing = false;
                let startX = 0, startY = 0;
                let savedImageData = null;
                
                // 도구 활성화 상태 업데이트 함수 (초기 로드시엔 호출되지 않음)
                function updateActiveTool(activeButton) {
                    // 초기화 버튼 제외한 모든 도구 버튼에서 active-tool 클래스 제거
                    document.querySelectorAll('.tool-button').forEach(btn => {
                        if (btn.id !== "clearBtn") {
                            btn.classList.remove("active-tool");
                        }
                    });
                    activeButton.classList.add("active-tool");
                }
                
                // 도구 선택 이벤트 리스너 (클릭 시 활성화 스타일 적용)
                pencilBtn.addEventListener("click", function() {
                    currentTool = "pencil";
                    ctx.strokeStyle = "#FFFFFF"; // 흰색 선
                    ctx.lineWidth = parseFloat(sizeSlider.value); // parseFloat로 소수점 처리
                    updateActiveTool(pencilBtn);
                });
                lineBtn.addEventListener("click", function() {
                    currentTool = "line";
                    ctx.strokeStyle = "#FFFFFF";
                    ctx.lineWidth = parseFloat(sizeSlider.value);
                    updateActiveTool(lineBtn);
                });
                circleBtn.addEventListener("click", function() {
                    currentTool = "circle";
                    ctx.strokeStyle = "#FFFFFF";
                    ctx.lineWidth = parseFloat(sizeSlider.value);
                    updateActiveTool(circleBtn);
                });
                squareBtn.addEventListener("click", function() {
                    currentTool = "square";
                    ctx.strokeStyle = "#FFFFFF";
                    ctx.lineWidth = parseFloat(sizeSlider.value);
                    updateActiveTool(squareBtn);
                });
                eraserBtn.addEventListener("click", function() {
                    currentTool = "eraser";
                    ctx.strokeStyle = "#000000"; // 배경색과 동일하게 지우기
                    ctx.lineWidth = parseFloat(sizeSlider.value) + 2; // 지우개는 펜보다 조금 크게 (+2)
                    updateActiveTool(eraserBtn);
                });
                clearBtn.addEventListener("click", function() {
                    clearCanvas();
                    localStorage.removeItem("savedCanvas");
                    // 초기화 버튼 클릭 시 활성 도구 상태는 변경하지 않음
                });
        
                // 마우스 위치 보정 함수
                function getMousePos(event) {
                    const rect = canvas.getBoundingClientRect();
                    return {
                        x: (event.clientX - rect.left) * (canvas.width / rect.width),
                        y: (event.clientY - rect.top) * (canvas.height / rect.height)
                    };
                }
        
                // 캔버스 이벤트
                canvas.addEventListener("mousedown", (event) => {
                    drawing = true;
                    const { x, y } = getMousePos(event);
                    if (currentTool === "pencil" || currentTool === "eraser") {
                        ctx.beginPath();
                        ctx.moveTo(x, y);
                    } else if (currentTool === "line" || currentTool === "circle" || currentTool === "square") {
                        startX = x;
                        startY = y;
                        savedImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    }
                });
        
                canvas.addEventListener("mousemove", (event) => {
                    if (!drawing) return;
                    const { x, y } = getMousePos(event);
                    if (currentTool === "pencil" || currentTool === "eraser") {
                        ctx.lineTo(x, y);
                        ctx.stroke();
                    } else if (currentTool === "line") {
                        ctx.putImageData(savedImageData, 0, 0);
                        ctx.beginPath();
                        ctx.moveTo(startX, startY);
                        ctx.lineTo(x, y);
                        ctx.stroke();
                    } else if (currentTool === "circle") {
                        ctx.putImageData(savedImageData, 0, 0);
                        let radius = Math.sqrt(Math.pow(x - startX, 2) + Math.pow(y - startY, 2));
                        ctx.beginPath();
                        ctx.arc(startX, startY, radius, 0, 2 * Math.PI);
                        ctx.stroke();
                    } else if (currentTool === "square") {
                        ctx.putImageData(savedImageData, 0, 0);
                        let width = x - startX;
                        let height = y - startY;
                        ctx.beginPath();
                        ctx.rect(startX, startY, width, height);
                        ctx.stroke();
                    }
                });
        
                canvas.addEventListener("mouseup", () => {
                    drawing = false;
                    if (currentTool === "pencil" || currentTool === "eraser") {
                        ctx.closePath();
                    } else if (currentTool === "line" || currentTool === "circle" || currentTool === "square") {
                        ctx.closePath();
                    }
                    // 캔버스 상태를 로컬 스토리지에 저장
                    const dataUrl = canvas.toDataURL("image/png");
                    localStorage.setItem("savedCanvas", dataUrl);
                });
        
                canvas.addEventListener("mouseleave", () => {
                    drawing = false;
                });
                
                // 페이지 로드시 로컬 스토리지에 저장된 캔버스 데이터가 있으면 불러오기
                const savedDataUrl = localStorage.getItem("savedCanvas");
                if (savedDataUrl) {
                    const img = new Image();
                    img.onload = function () {
                        clearCanvas();
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    };
                    img.src = savedDataUrl;
                } else {
                    clearCanvas();
                }
                
                // 크기 슬라이더 변경 이벤트
                sizeSlider.addEventListener("input", function() {
                    const size = parseFloat(this.value);
                    if (currentTool === "eraser") {
                        ctx.lineWidth = size + 2; // 지우개일 경우 더 크게
                    } else {
                        ctx.lineWidth = size;
                    }
                    updateSizePreview();
                });
                
                // [변경 전] 기본 활성 도구 설정 코드는 제거되어, 로드시에는 어떤 도구도 하이라이트되지 않음.
            });
        </script>
        
    </head>
    <body class="bg-gray-50">
        <!-- Header -->
        <header class="fixed w-full z-50 glass-effect">
            <div class="container mx-auto px-6">
                <nav class="flex items-center justify-between h-20">
                    <a href="index.html" class="text-2xl font-bold gradient-text tracking-tight">가꿈</a>
                    <div class="hidden md:flex">
                        <span class="text-gray-700 text-lg">Where Dreams Are Drawn ⁞ 앨리스 AI Spark Camp ⁞ 1조</span>
                    </div>
                </nav>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="pt-32 pb-24">
            <div class="container mx-auto px-6">
                <!-- Title Section -->
                <div class="text-center max-w-3xl mx-auto mb-16">
                    <h1 class="text-6xl font-bold mb-6">
                        <span class="gradient-text">꿈의 가구</span>
                        스케치하기
                    </h1>
                    <p class="text-xl text-gray-600">
                        스케치부터 시작하는 혁신적인 가구 디자인, AI와 함께 당신만의 작품을 만들어보세요.
                    </p>
                </div>
        
                <!-- Main Workspace -->
                <div class="grid lg:grid-cols-12 gap-8 mb-16">
                    <!-- Tools Panel -->
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-white rounded-3xl p-6 shadow-lg card-hover">
                            <h3 class="text-lg font-bold mb-6 gradient-text">Drawing Tools</h3>
                            <div class="space-y-4">
                                <!-- 연필 -->
                                <button id="pencilBtn" class="tool-button w-full p-4 rounded-2xl flex items-center justify-center space-x-3 bg-gray-50">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                    </svg>
                                    <span>연필</span>
                                </button>
                                <!-- 직선 -->
                                <button id="lineBtn" class="tool-button w-full p-4 rounded-2xl flex items-center justify-center space-x-3 bg-gray-50">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <line x1="4" y1="20" x2="20" y2="4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></line>
                                    </svg>
                                    <span>직선</span>
                                </button>
                                <!-- 원형 -->
                                <button id="circleBtn" class="tool-button w-full p-4 rounded-2xl flex items-center justify-center space-x-3 bg-gray-50">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="8" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></circle>
                                    </svg>
                                    <span>원형</span>
                                </button>
                                <!-- 사각형 -->
                                <button id="squareBtn" class="tool-button w-full p-4 rounded-2xl flex items-center justify-center space-x-3 bg-gray-50">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <rect x="6" y="6" width="12" height="12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></rect>
                                    </svg>
                                    <span>사각형</span>
                                </button>
                                <!-- 지우개 -->
                                <button id="eraserBtn" class="tool-button w-full p-4 rounded-2xl flex items-center justify-center space-x-3 bg-gray-50">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                    <span>지우개</span>
                                </button>
                                <!-- 초기화 -->
                                <button id="clearBtn" class="tool-button w-full p-4 rounded-2xl flex items-center justify-center space-x-3 bg-gray-50">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    <span>초기화</span>
                                </button>
                            </div>
                        </div>
        
                        <!-- Properties 박스 -->
                        <div class="bg-white rounded-3xl p-6 shadow-lg card-hover">
                            <h3 class="text-lg font-bold mb-6 gradient-text">Properties</h3>
                            <div class="space-y-4">
                                <!-- 크기 -->
                                <div>
                                    <label class="block text-sm text-gray-600 mb-2">크기</label>
                                    <input id="sizeSlider" type="range" class="w-full accent-indigo-600" min="0.2" max="10" step="0.2" value="1">
                                </div>
                                <!-- 크기 미리보기 박스 -->
                                <div class="bg-gray-100 p-4 rounded-2xl flex justify-center items-center h-[100px] w-full">
                                    <div id="sizePreview" class="rounded-full bg-indigo-600 transition-all"></div>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <!-- Canvas Area -->
                    <div class="lg:col-span-8">
                        <div class="canvas-bg rounded-3xl p-8 shadow-lg">
                            <div class="gradient-border rounded-2xl bg-white p-4 flex justify-center items-center">
                                <canvas id="sketchCanvas" width="256" height="256" class="w-full h-auto rounded-xl" style="max-width: 710px; aspect-ratio: 1 / 1;"></canvas>
                            </div>
                        </div>
                        
                        <!-- 레퍼런스 이미지 섹션 (캔버스 아래에 추가) -->
                        <div class="mt-8 bg-white rounded-3xl p-6 shadow-lg card-hover">
                            <h3 class="text-lg font-bold mb-6 gradient-text">스케치 레퍼런스</h3>
                            <div class="grid grid-cols-5 gap-4">
                                <!-- 5개의 레퍼런스 이미지 -->
                                <div class="reference-item cursor-pointer transition-all hover:scale-105">
                                    <img src="img/reference1.png" alt="소파" class="rounded-xl w-full h-32 object-cover shadow-md">
                                    <p class="mt-2 text-sm font-medium text-center">소파</p>
                                </div>
                                <div class="reference-item cursor-pointer transition-all hover:scale-105">
                                    <img src="img/reference2.png" alt="옷장" class="rounded-xl w-full h-32 object-cover shadow-md">
                                    <p class="mt-2 text-sm font-medium text-center">장롱</p>
                                </div>
                                <div class="reference-item cursor-pointer transition-all hover:scale-105">
                                    <img src="img/reference3.png" alt="의자" class="rounded-xl w-full h-32 object-cover shadow-md">
                                    <p class="mt-2 text-sm font-medium text-center">의자</p>
                                </div>
                                <div class="reference-item cursor-pointer transition-all hover:scale-105">
                                    <img src="img/reference4.png" alt="테이블" class="rounded-xl w-full h-32 object-cover shadow-md">
                                    <p class="mt-2 text-sm font-medium text-center">테이블</p>
                                </div>
                                <div class="reference-item cursor-pointer transition-all hover:scale-105">
                                    <img src="img/reference5.png" alt="책상" class="rounded-xl w-full h-32 object-cover shadow-md">
                                    <p class="mt-2 text-sm font-medium text-center">모니터</p>
                                </div>
                            </div>
                            <p class="text-gray-500 text-sm mt-3 text-center">이미지를 클릭하여 캔버스에 적용해보세요</p>
                        </div>
                    </div>
        
                    <!-- Right Panel -->
                    <div class="lg:col-span-2 space-y-6">
                        <div class="bg-white rounded-3xl p-6 shadow-lg card-hover">
                            <h3 class="text-lg font-bold mb-6 gradient-text">Upload</h3>
                            <div class="upload-area rounded-2xl p-6 text-center">
                                <svg class="w-12 h-12 mx-auto mb-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                </svg>
                                <p class="text-sm text-gray-600 mb-4">Drag & Drop<br>or</p>
                                <button class="bg-indigo-600 text-white px-6 py-2 rounded-full hover:bg-indigo-700 transition-all">
                                    파일 찾기
                                </button>
                            </div>
                        </div>
        
                        <!-- 저장하기 & 공유하기 버튼 -->
                        <div class="flex flex-col space-y-4 w-full">
                            <button id="saveButton" class="bg-white text-gray-700 py-3 rounded-2xl shadow-lg transition-all flex items-center justify-center space-x-2 w-full card-hover gradient-border">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                                </svg>
                                <span>저 장 하 기</span>
                            </button>
                            <button id="shareButton" class="bg-white text-gray-700 py-3 rounded-2xl shadow-lg transition-all flex items-center justify-center space-x-2 w-full card-hover gradient-border">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                                </svg>
                                <span>공 유 하 기</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 버튼스테이션: 양끝정렬, 버튼 가로 여백 증가 -->
                <div class="flex justify-between mt-8">
                    <button onclick="goToHomePage()" 
                        class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-12 py-3 rounded-full hover:opacity-90 shadow-lg transition-all flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                        <span>홈페이지 가기</span>
                    </button>
                    <button onclick="goToAIDesign()" 
                        class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-12 py-3 rounded-full hover:opacity-90 shadow-lg transition-all flex items-center space-x-2">
                        <span>AI 디자인 생성</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </main>
        
        <script>
    function goToHomePage() {
        window.location.href = "index.html";
    }
    async function goToAIDesign() {
        const canvas = document.getElementById("sketchCanvas");
        const blob = await new Promise(resolve => canvas.toBlob(resolve, "image/png"));
        const formData = new FormData();
        formData.append("file", blob, "sketch.png");

        try {
            // URL 변경: 새 서버 주소로 업데이트
            const response = await fetch("https://jjaqzskahktzmmgb.tunnel-pt.elice.io/proxy/8000/inference", {
                method: "POST",
                body: formData
            });
            if (!response.ok) {
                throw new Error("서버 응답 오류: " + response.statusText);
            }
            const resultBlob = await response.blob();
            const dataUrl = await new Promise(resolve => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(resultBlob);
            });
            localStorage.setItem("aiDesignImage", dataUrl);
            window.location.href = "2_AI.html";
        } catch (error) {
            console.error("서버 전송 실패:", error);
            alert("AI 서버 연결에 문제가 발생했습니다. 다시 시도해주세요.");
        }
    }
</script>
        
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const sizeSlider = document.getElementById("sizeSlider");
                const sizePreview = document.getElementById("sizePreview");
                const previewContainer = sizePreview.parentElement;
        
                function updateSizePreview() {
                    let size = sizeSlider.value;
                    sizePreview.style.width = size + "px";
                    sizePreview.style.height = size + "px";
                    sizePreview.style.display = "flex";
                    sizePreview.style.alignItems = "center";
                    sizePreview.style.justifyContent = "center";
                    sizePreview.style.backgroundColor = "#6366F1";
                    previewContainer.style.height = "100px";
                    previewContainer.style.width = "100%";
                }
        
                updateSizePreview();
                sizeSlider.addEventListener("input", updateSizePreview);
            });
        </script>
        
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const uploadArea = document.querySelector(".upload-area");
                const fileInput = document.createElement("input");
                fileInput.type = "file";
                fileInput.accept = "image/*";
        
                // 파일 선택 버튼 클릭 시 파일 선택 다이얼로그 열기
                uploadArea.querySelector("button").addEventListener("click", function () {
                    fileInput.click();
                });
        
                // 파일이 선택되었을 때 처리 - 여기가 누락되었음
                fileInput.addEventListener("change", function(e) {
                    if (this.files && this.files[0]) {
                        handleFileUpload(this.files[0]);
                    }
                });
        
                // 드래그 앤 드롭 이벤트 처리
                uploadArea.addEventListener("dragover", function (event) {
                    event.preventDefault();
                    uploadArea.style.borderColor = "#A855F7";
                });
        
                uploadArea.addEventListener("dragleave", function () {
                    uploadArea.style.borderColor = "#6366F1";
                });
        
                uploadArea.addEventListener("drop", function (event) {
                    event.preventDefault();
                    uploadArea.style.borderColor = "#6366F1";
                    if (event.dataTransfer.files.length > 0) {
                        handleFileUpload(event.dataTransfer.files[0]);
                    }
                });
        
                function handleFileUpload(file) {
                    if (!file.type.startsWith("image/")) {
                        alert("이미지 파일만 업로드 가능합니다!");
                        return;
                    }
        
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const img = new Image();
                        img.onload = function () {
                            const canvas = document.getElementById("sketchCanvas");
                            const ctx = canvas.getContext("2d");
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                            const dataUrl = canvas.toDataURL("image/png");
                            localStorage.setItem("savedCanvas", dataUrl);
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });
        </script>
        
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const saveButton = document.getElementById("saveButton");
                const shareButton = document.getElementById("shareButton");
                const canvas = document.getElementById("sketchCanvas");
        
                saveButton.addEventListener("click", function () {
                    const image = canvas.toDataURL("image/png");
                    const link = document.createElement("a");
                    link.href = image;
                    link.download = "sketch.png";
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                });
        
                shareButton.addEventListener("click", async function () {
                    try {
                        const blob = await new Promise(resolve => canvas.toBlob(resolve, "image/png"));
                        const item = new ClipboardItem({ "image/png": blob });
                        await navigator.clipboard.write([item]);
                        alert("이미지가 클립보드에 복사되었습니다!\n이미지를 붙여넣기하여 공유하세요.");
                    } catch (err) {
                        console.error("이미지 복사 실패", err);
                        alert("이미지 복사에 실패했습니다.\n브라우저 설정을 확인해주세요.");
                    }
                });
            });
        </script>
        
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const referenceItems = document.querySelectorAll('.reference-item img');
                const canvas = document.getElementById("sketchCanvas");
                const ctx = canvas.getContext("2d");
                
                referenceItems.forEach(item => {
                    item.addEventListener('click', function() {
                        const imgSrc = this.getAttribute('src');
                        console.log('이미지 클릭됨:', imgSrc);
                        
                        const img = new Image();
                        img.onload = function() {
                            ctx.fillStyle = "#000000";
                            ctx.fillRect(0, 0, canvas.width, canvas.height);
                            
                            const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
                            const x = (canvas.width - img.width * scale) / 2;
                            const y = (canvas.height - img.height * scale) / 2;
                            
                            ctx.drawImage(img, 0, 0, img.width, img.height, x, y, img.width * scale, img.height * scale);
                            
                            const dataUrl = canvas.toDataURL("image/png");
                            localStorage.setItem("savedCanvas", dataUrl);
                            console.log('이미지가 캔버스에 그려짐');
                        };
                        
                        img.onerror = function() {
                            console.error('이미지 로드 실패:', imgSrc);
                            alert('레퍼런스 이미지를 불러올 수 없습니다.');
                        };
                        
                        img.src = imgSrc;
                    });
                });
            });
        </script>
        
    </body>
</html>
